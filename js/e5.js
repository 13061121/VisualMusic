define(["analyser","util"],function(a,b){function c(){this.x=Math.round(Math.random()*q.width),this.y=Math.round(Math.random()*q.height),this.rad=Math.round(10*Math.random())+15,this.rgba=u[b.intRandom(0,5)],this.vx=Math.round(3*Math.random())-1.5,this.vy=Math.round(3*Math.random())-1.5}function d(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}function e(){for(r.save(),h=a.getData(),m=h.length/2,r.clearRect(0,0,q.width,q.height),r.globalCompositeOperation="lighter",r.linewidth=.5,k=0,o=0;m>k;k++)o+=h[k];for(p=o/m,k=0;m>k;k++){for(i=s[k],n=1,l=0;m>l;l++)j=s[l],i.rgba==j.rgba&&d(i,j)<p&&(r.strokeStyle=i.rgba,r.beginPath(),r.moveTo(i.x,i.y),r.lineTo(j.x,j.y),r.stroke(),n+=.6);r.fillStyle=i.rgba,r.strokeStyle=i.rgba,r.beginPath(),r.arc(i.x,i.y,i.rad*n,0,2*Math.PI,!0),r.fill(),r.closePath(),r.beginPath(),r.arc(i.x,i.y,(i.rad+5)*n,0,2*Math.PI,!0),r.stroke(),r.closePath(),i.x+=i.vx,i.y+=i.vy,i.x>q.width+i.rad&&(i.x=0),i.x<-i.rad&&(i.x=q.width),i.y>q.height+i.rad&&(i.y=0),i.y<-i.rad&&(i.y=q.height)}r.restore()}function f(){b.setBg(5);for(var a=0;t>a;a++)s.push(new c);v=!0}function g(){return v}var h,i,j,k,l,m,n,o,p,q=b.getById("visual-canvas"),r=q.getContext("2d"),s=[],t=a.getFftSize()/4,u=["#f35d4f","#f36849","#c0d988","#6ddaf1","#f1e85b"],v=!1;return{draw:e,init:f,isInit:g}});