define(["analyser","util"],function(a,b){function c(){i.save();var b=0,c=l;f=a.getData(),i.clearRect(0,0,h.width,h.height);for(var d=0;d<f.length;d++)b+=f[d];l=b/f.length;for(var e=l-c,g=Math.abs(e),d=0,m=j.length;m>d;d+=2){var n=j[d];e>0?(n.r+=g/10,n.r>n.maxR&&(n.r-=(n.r-n.maxR)/5),n.o+=.05,n.o>1&&(n.o=1)):(n.r-=g/5,n.r<0&&(n.r=.01),n.r<n.minR&&(n.r+=(n.minR-n.r)/10),n.o-=.05,n.o<n.minO&&(n.o=n.minO)),k+=1e-4,n.y+=Math.cos(k+n.d)-2,n.x+=Math.sin(k+n.d),n.x>h.width+5?(n.x=-5,n.d=50*Math.random()):n.x<-5?(n.x=h.width+5,n.d=50*Math.random()):n.y<0&&(n.y=h.height+5,n.d=50*Math.random());var o=i.createRadialGradient(n.x,n.y,2,n.x,n.y,n.r+3);o.addColorStop(0,"rgba(255, 255, 255, "+n.o+")"),o.addColorStop(1,"rgba("+n.c+", 0)"),i.fillStyle=o,i.beginPath(),i.moveTo(n.x,n.y),i.arc(n.x,n.y,n.r+3,0,2*Math.PI,!0),i.closePath(),i.fill()}var p=h.width/2,q=h.height,r=5*l;o=i.createRadialGradient(p,q,r/8,p,q,r),o.addColorStop(0,"rgba(175, 221, 255, 0.5)"),o.addColorStop(1,"rgba(76, 159, 219, 0)"),i.fillStyle=o,i.beginPath(),i.arc(p,q,r,0,2*Math.PI,!0),i.closePath(),i.fill(),i.restore()}function d(){b.setBg(3);for(var c=a.getFftSize()/2,d=h.width,e=h.height,f=m.length,g=0;c>g;g++)j[g]={x:Math.random()*d,y:Math.random()*e,r:5*Math.random(),minR:5*Math.random()+1,maxR:12*Math.random()+5,d:50*Math.random(),c:m[b.intRandom(0,f)]},j[g].minO=j[g].o=.8*Math.random()+.2;n=!0}function e(){return n}var f,g="e3.jpg",h=b.getById("visual-canvas"),i=h.getContext("2d"),j=[],k=0,l=0,m=["105, 210, 231","255, 255, 255","248, 37, 77","248, 225, 16"],n=!1;return{draw:c,init:d,isInit:e,cover:g}});