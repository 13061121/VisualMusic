define(["analyser","util"],function(a,b){function c(){for(r.save(),g=a.getData(),h=q.width,i=q.height,m=i/2,r.clearRect(0,0,h,i),j=0;u>j;j++)t[j]=g[j]*s[j];for(r.shadowColor="#fffa47",r.shadowBlur=15,r.strokeStyle=p,r.lineWidth=2,r.beginPath(),k=0,l=Math.ceil(h/u),r.moveTo(k,m),j=1;u-2>j;j++)n=(k+k+l)/2,o=m-(t[j]+t[j+1])/2,r.quadraticCurveTo(k,m-t[j],n,o),k+=l;r.quadraticCurveTo(k,m-t[j],k+l,m-t[j+1]),r.stroke(),r.restore()}function d(){b.setBg(8);var a=.1*Math.random()+.05,c=0;for(s[0]=Math.sin(c),j=1;u>j;j++)s[j]=Math.sin(c),(s[j-1]>0&&s[j]<0||s[j-1]<0&&s[j]>0)&&(a=.1*Math.random()+.05),c+=a;e(),v=!0}function e(){p=r.createLinearGradient(0,0,0,q.height),p.addColorStop(.1,"#ff5614"),p.addColorStop(.3,"#fffa47"),p.addColorStop(.4,"#f93b04"),p.addColorStop(.5,"#f93b04"),p.addColorStop(.6,"#fffa47"),p.addColorStop(.7,"#f93b04"),p.addColorStop(.75,"#f01800"),p.addColorStop(.8,"#fb7220"),p.addColorStop(.9,"#f93b04"),p.addColorStop(1,"#f01800")}function f(){return v}var g,h,i,j,k,l,m,n,o,p,q=b.getById("visual-canvas"),r=q.getContext("2d"),s=[],t=[],u=a.getFftSize()/2-20,v=!1;return $(window).resize(function(){e()}),{draw:c,init:d,isInit:f}});