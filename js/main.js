require.config({}),define(["util","effect"],function(a,b){function c(b){for(var c=b.length,d=A.length,e="",f=0,g=-1,h=0;c>h;h++)if(0==b[h].type.indexOf("audio")){var i=a.getRidOfExtention(b[h].name);"undefined"==typeof B[i]?(B[i]=A.length,A.push(b[h]),e+='<li num="'+(A.length-1)+'">'+i+"</li>",f++):g=B[i]}f>0?(q.append(e),n(d)):-1!=g&&n(g)}function d(){switch(D=(D+1)%3,v.removeClass(),D){case 0:break;case 1:v.addClass("rand");break;case 2:v.addClass("single")}}function e(a){a.stopPropagation(),a.preventDefault()}function f(a){a.stopPropagation(),a.preventDefault(),c(a.dataTransfer.files)}function g(){switch(D){case 0:h();break;case 1:j(a.intRandom(0,A.length-1));break;case 2:x.play()}}function h(){var a=A.length,b=y;0!=a&&(b++,b%=a,n(b))}function i(){var a=A.length,b=y;0!=a&&(b--,-1==b&&(b=a-1),n(b))}function j(a){n(a)}function k(){1==x.paused?x.play():x.pause()}function l(){localStorage.playMode=D,b.saveSetting()}function m(){if(localStorage.playMode)switch(D=+localStorage.playMode,v.removeClass(),D){case 1:v.addClass("rand");break;case 2:v.addClass("single")}}function n(a){y!=a&&(o(),y=a,E.readAsDataURL(A[y]),q.find("li").each(function(){+$(this).attr("num")==a?($("title").text($(this).text()),$(this).addClass("playing")):$(this).removeClass("playing")}))}function o(){b.stopDraw(),x.pause()}var p=$("body"),q=$("#file-list"),r=$("#file-list-wrapper"),s=$("#help-wrapper"),t=$("#input-file"),u=$("#music"),v=$("#play-mode"),w=$("#title"),x=a.getById("music"),y=-1,z=document,A=[],B={},C=a.getById("input-file"),D=0,E=new FileReader;E.onload=function(a){a.target.result;w.text(""),u.removeClass("hidden"),s.addClass("hidden"),x.src=a.target.result,x.play(),b.beginDraw()},m(),p.on("click","#help-btn",function(){$("#help").fadeIn("fast");var a=$("#help img").first(),b=a.attr("data-src");a.attr("src",b)}).on("click","#help",function(){$(this).fadeOut("fast")}).on("click","#title",function(){t.click()}).on("click","#play-mode",function(){d()}).on("click","#fullscreen",function(){a.fullscreenSwitch()}),z.addEventListener("drop",function(a){f(a)},!1),z.addEventListener("dragenter",e,!1),z.addEventListener("dragexit",e,!1),z.addEventListener("dragover",e,!1),x.addEventListener("ended",function(){g()},!1),p.on("click","#file-list li",function(){var a=$(this).attr("num");j(+a)}).on("contextmenu",function(a){a.preventDefault(),r.css("0px"!=r.css("left")?{left:"0"}:{left:"-200px"})}),z.addEventListener("keydown",function(a){switch(a.keyCode){case 32:k();break;case 37:b.pre();break;case 39:b.next();break;case 38:i();break;case 40:h()}},!1),$(window).on("beforeunload",function(){l()}),t.on("change",function(){c(C.files)})});