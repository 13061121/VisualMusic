require.config({}),define(["util","effect"],function(a,b){function c(b){for(var c=b.length,d=D.length,e="",f=0,g=-1,h=0;c>h;h++)if(0==b[h].type.indexOf("audio")){var i=a.getRidOfExtention(b[h].name);"undefined"==typeof E[i]?(E[i]=D.length,D.push(b[h]),e+='<li num="'+(D.length-1)+'">'+i+"</li>",f++):g=E[i]}f>0?(q.append(e),n(d)):-1!=g&&n(g)}function d(){switch(G=(G+1)%3,w.removeClass(),G){case 0:break;case 1:w.addClass("rand");break;case 2:w.addClass("single")}}function e(a){a.stopPropagation(),a.preventDefault()}function f(a){a.stopPropagation(),a.preventDefault(),c(a.dataTransfer.files)}function g(){switch(G){case 0:h();break;case 1:j(a.intRandom(0,D.length-1));break;case 2:A.play()}}function h(){var a=D.length,b=B;0!=a&&(b++,b%=a,n(b))}function i(){var a=D.length,b=B;0!=a&&(b--,-1==b&&(b=a-1),n(b))}function j(a){n(a)}function k(){1==A.paused?A.play():A.pause()}function l(){localStorage.playMode=G,b.saveSetting()}function m(){if(localStorage.playMode)switch(G=+localStorage.playMode,w.removeClass(),G){case 1:w.addClass("rand");break;case 2:w.addClass("single")}}function n(a){B!=a&&(o(),B=a,H.readAsDataURL(D[B]),q.find("li").each(function(){if(+$(this).attr("num")==a){$(this).addClass("playing");var b=$(this).text();$("title").text(b),x.text(b),null!==y&&(clearTimeout(y),x.removeClass("showAndHide"),x[0].offsetWidth=x[0].offsetWidth),x.addClass("showAndHide"),y=setTimeout(function(){y=null,x.removeClass("showAndHide")},15e3)}else $(this).removeClass("playing")}))}function o(){b.stopDraw(),A.pause()}var p=$("body"),q=$("#file-list"),r=$("#file-list-wrapper"),s=$("#effect-list-wrapper"),t=$("#help-wrapper"),u=$("#input-file"),v=$("#music"),w=$("#play-mode"),x=$("#song-name"),y=null,z=$("#title"),A=a.getById("music"),B=-1,C=document,D=[],E={},F=a.getById("input-file"),G=0,H=new FileReader;H.onload=function(a){a.target.result;z.text(""),v.removeClass("hidden"),t.addClass("hidden"),A.src=a.target.result,A.play(),b.beginDraw()},m(),p.on("click","#help-btn",function(){$("#help").fadeIn("fast");var a=$("#help img").first(),b=a.attr("data-src");a.attr("src",b)}).on("click","#help",function(){$(this).fadeOut("fast")}).on("click","#title",function(){u.click()}).on("click","#play-mode",function(){d()}).on("click","#fullscreen",function(){a.fullscreenSwitch()}),C.addEventListener("drop",function(a){f(a)},!1),C.addEventListener("dragenter",e,!1),C.addEventListener("dragexit",e,!1),C.addEventListener("dragover",e,!1),A.addEventListener("ended",function(){g()},!1),p.on("click","#file-list li",function(){var a=$(this).attr("num");j(+a)}).on("contextmenu",function(a){a.preventDefault(),"0px"!=r.css("left")?(r.css({left:"0"}),s.css({right:"0"})):(r.css({left:"-200px"}),s.css({right:"-200px"}))}),C.addEventListener("keydown",function(a){switch(a.keyCode){case 32:k();break;case 37:b.pre();break;case 39:b.next();break;case 38:i();break;case 40:h()}},!1),$(window).on("beforeunload",function(){l()}),u.on("change",function(){c(F.files)})});