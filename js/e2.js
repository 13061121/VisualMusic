define(["analyser","util"],function(a,b){function c(){h=b.intRandom(0,9),3>h?(p.r=p.r+p.rS*p.rD,p.r>225?p.rD=-1:p.r<100&&(p.rD=1)):6>h?(p.g=p.g+p.gS*p.gD,p.g>225?p.gD=-1:p.g<100&&(p.gD=1)):(p.b=p.b+p.bS*p.bD,p.b>225?p.bD=-1:p.b<100&&(p.bD=1))}function d(){var b=i.width/128,d=0,e=0,f=1,h=i.height/2,q=0,r=0,s=0,t=o;g=a.getData(),j.save(),j.clearRect(0,0,i.width,i.height),c();var u=(j.createLinearGradient(0,0,i.width,i.height),p.r),v=p.g,w=p.b;if(j.shadowColor="rgba("+(u+70)+", "+(v+70)+", "+(w+70)+", 1)",j.shadowBlur=n,j.strokeStyle="rgba("+u+", "+v+", "+w+", 1)",j.lineWidth=5,j.lineJoin="miter",j.miterLimit=100,j.beginPath(),j.moveTo(0,h),0==m){m=Math.floor(50*Math.random())+20;for(var x=0;128>x;x++)l[x]=0;r=Math.floor(15*Math.random());for(var x=0;r>x;x++){q=Math.floor(15*Math.random());var y=Math.floor(128*Math.random());l[y]=1;for(var z=1;q>z;z++)l[y+z]=1}}else m--;for(var x=0;128>x;x++)e=g[x]-.5*(100-x),e=0>e-80?0:e-80,e>h&&(e=h),1==l[x]?(k[x]-=20,k[x]<0&&(k[x]=0),e=k[x]):e-k[x]>20?(k[x]+=20,e=k[x]):k[x]=e,e=e*f+h,j.lineTo(d,e),s+=e,f=-f,d+=b;o=s/128,t>o?n--:n++,j.lineTo(i.width,h),j.stroke(),j.restore()}function e(){b.setBg(2);for(var a=0;256>a;a++)k[a]=0;p={r:100,g:100,b:100,rS:b.intRandom(1,3),gS:b.intRandom(1,3),bS:b.intRandom(1,3),rD:1,gD:1,bD:1},q=!0}function f(){return q}var g,h,i=b.getById("visual-canvas"),j=i.getContext("2d"),k=[],l=[],m=0,n=0,o=0,p=null,q=!1;return{draw:d,init:e,isInit:f}});