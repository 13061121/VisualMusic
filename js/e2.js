define(["analyser","util"],function(a,b){function c(){h=b.intRandom(0,9),3>h?(q.r=q.r+q.rS*q.rD,q.r>225?q.rD=-1:q.r<100&&(q.rD=1)):6>h?(q.g=q.g+q.gS*q.gD,q.g>225?q.gD=-1:q.g<100&&(q.gD=1)):(q.b=q.b+q.bS*q.bD,q.b>225?q.bD=-1:q.b<100&&(q.bD=1))}function d(){var b=j.width/128,d=0,e=0,f=1,h=j.height/2,i=0,r=0,s=0,t=p;g=a.getData(),k.save(),k.clearRect(0,0,j.width,j.height),c();var u=(k.createLinearGradient(0,0,j.width,j.height),q.r),v=q.g,w=q.b;if(k.shadowColor="rgba("+(u+70)+", "+(v+70)+", "+(w+70)+", 1)",k.shadowBlur=o,k.strokeStyle="rgba("+u+", "+v+", "+w+", 1)",k.lineWidth=5,k.lineJoin="miter",k.miterLimit=100,k.beginPath(),k.moveTo(0,h),0==n){n=Math.floor(50*Math.random())+20;for(var x=0;128>x;x++)m[x]=0;r=Math.floor(15*Math.random());for(var x=0;r>x;x++){i=Math.floor(15*Math.random());var y=Math.floor(128*Math.random());m[y]=1;for(var z=1;i>z;z++)m[y+z]=1}}else n--;for(var x=0;128>x;x++)e=g[x]-.5*(100-x),e=0>e-80?0:e-80,e>h&&(e=h),1==m[x]?(l[x]-=20,l[x]<0&&(l[x]=0),e=l[x]):e-l[x]>20?(l[x]+=20,e=l[x]):l[x]=e,e=e*f+h,k.lineTo(d,e),s+=e,f=-f,d+=b;p=s/128,t>p?o--:o++,k.lineTo(j.width,h),k.stroke(),k.restore()}function e(){b.setBg(2);for(var a=0;256>a;a++)l[a]=0;q={r:100,g:100,b:100,rS:b.intRandom(1,3),gS:b.intRandom(1,3),bS:b.intRandom(1,3),rD:1,gD:1,bD:1},r=!0}function f(){return r}var g,h,i="e2.jpg",j=b.getById("visual-canvas"),k=j.getContext("2d"),l=[],m=[],n=0,o=0,p=0,q=null,r=!1;return{draw:d,init:e,isInit:f,cover:i}});